#â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
# â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•— mescr modules             
# â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘  â•šâ•â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• not lisensed              
# â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•   â•šâ•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•— https://t.me/mescr_m      
# â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
# â•šâ•â•     â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â• â•šâ•â•  â•šâ•â•  
#â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
#â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# meta developer: @mescr_m 
#â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# idea:             
# thanks:                   
#â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

from .. import utils, loader
import asyncio
import datetime
from telethon.tl import functions

__version__ = (1, 0, 1)

class NameTime(loader.Module):
    '''ĞœĞ¾Ğ´ÑƒĞ»ÑŒ Ğ´Ğ»Ñ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ² Ğ½Ğ¸ĞºĞµ\nDeveloper: @mescr_m'''

    strings = {
        'name': 'NameTime',
        'timezone': 'Ğ’Ğ°Ñˆ Ñ‡Ğ°ÑĞ¾Ğ²Ğ¾Ğ¹ Ğ¿Ğ¾ÑÑ Ğ¾Ñ‚ ĞœĞ¡Ğš. ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°: ĞœĞ¾ÑĞºĞ²Ğ° = 0, ĞšĞ°Ğ»Ğ¸Ğ½Ğ¸Ğ½Ğ³Ñ€Ğ°Ğ´ = -1, ĞĞ¼ÑĞº = 3, Ğ’Ğ»Ğ°Ğ´Ğ¸Ğ²Ğ¾ÑÑ‚Ğ¾Ğº = 7',
        'sleep': 'Ğ Ğ°Ğ· Ğ² ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑÑ‚ÑŒ Ğ²Ñ€ĞµĞ¼Ñ Ğ² Ğ½Ğ¸ĞºĞµ? Ğ§ĞµĞ¼ Ğ²Ñ‹ÑˆĞµ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»ÑŒ, Ñ‚ĞµĞ¼ Ğ½Ğ¸Ğ¶Ğµ Ğ²ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ Ğ±Ğ°Ğ½Ğ° Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°.',
        'autostart': 'Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°Ñ‚ÑŒ Ğ»Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸, Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ ÑĞ·ĞµÑ€Ğ±Ğ¾Ñ‚Ğ°?'
    }

    async def client_ready(self):
        self.set('status', False) if self.get('status') == None else None
        self.set('fact_status', False) if self.get('fact_status') == None else None
        if self.get('status') == True:
            await self.inline.bot.send_message(self.tg_id, f'â—ï¸ ĞœĞ¾Ğ´ÑƒĞ»ÑŒ NameTime Ğ±Ñ‹Ğ» Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½.')
            await self.nametime_function()
        else:
            self.set('status', False)
            self.set('fact_status', False)
        
    def __init__(self):
        self.config = loader.ModuleConfig(
            loader.ConfigValue(
                "timezone", 0,
                lambda: self.strings("timezone"),
                validator=loader.validators.Integer()
            ),
            loader.ConfigValue(
                "sleep", 1,
                lambda: self.strings("sleep"),
                validator=loader.validators.Choice([1, 2, 5, 10, 20, 30, 45, 60, 120])
            ),
            loader.ConfigValue(
                "autostart", False,
                lambda: self.strings("autostart"),
                validator=loader.validators.Boolean()
            ),
        )

    @loader.command()
    async def nameformat(self, message):
        '''[ Ğ½Ğ¸Ğº + {time} ] - ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ½Ğ¸ĞºĞ°'''
        args = utils.get_args_raw(message)
        if args:
            if '{time}' in args:
                self.set('nick', args)
                await utils.answer(message, f'<emoji document_id=5332533929020761310>âœ…</emoji> Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ½Ğ¸ĞºĞ° Ğ·Ğ°Ğ´Ğ°Ğ½: "<code>{args}</code>". Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ²Ñ‹ Ğ¼Ğ¾Ğ¶ĞµĞµÑ‚ Ğ²ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ²Ñ€ĞµĞ¼Ñ Ğ² Ğ½Ğ¸ĞºĞµ Ğ¸Ğ»Ğ¸ Ğ²Ñ‹ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ ĞµĞ³Ğ¾.')
                return
            else:
                await utils.answer(message, f'<emoji document_id=5980953710157632545>ğŸš«</emoji> <b>Error</b> // <code>{message.raw_text}</code>'
                '\n\n<emoji document_id=5818973781707722673>ğŸ—£</emoji> <b><u>Ğ¡ÑƒÑ‚ÑŒ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸:</u></b>\nĞ’ Ğ°Ñ€Ğ³ÑƒĞ¼ĞµĞ½Ñ‚Ğµ Ğ½ĞµÑ‚ "{time}".'
                '\n\n<emoji document_id=5821302890932736039>ğŸ—£</emoji> <b><u>Ğ¡Ğ¿Ğ¾ÑĞ¾Ğ±Ñ‹ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ:</u></b>\n')
                return
        else:
            await utils.answer(message, f'<emoji document_id=5980953710157632545>ğŸš«</emoji> <b>Error</b> // <code>{message.raw_text}</code>'
            '\n\n<emoji document_id=5818973781707722673>ğŸ—£</emoji> <b><u>Ğ¡ÑƒÑ‚ÑŒ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸:</u></b>\nĞ’Ñ‹ Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ»Ğ¸ Ğ°Ñ€Ğ³ÑƒĞ¼ĞµĞ½Ñ‚.'
            '\n\n<emoji document_id=5821302890932736039>ğŸ—£</emoji> <b><u>Ğ¡Ğ¿Ğ¾ÑĞ¾Ğ±Ñ‹ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ:</u></b>\nĞ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ°Ñ€Ğ³ÑƒĞ¼ĞµĞ½Ñ‚, Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, "EarlyStar | {time}". Ğ£Ñ‡Ñ‚Ğ¸Ñ‚Ğµ, Ñ‡Ñ‚Ğ¾ "{time}" Ğ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ·Ğ°Ğ¼ĞµĞ½ÑÑ‚ÑŒ Ğ½Ğ° Ğ²Ğ°ÑˆĞµ Ğ²Ñ€ĞµĞ¼Ñ, Ñ‚Ğ°Ğº ĞºĞ°Ğº ÑÑ‚Ğ¾ ÑĞ»Ğ¾Ğ²Ğ¾ ÑĞ»ÑƒĞ¶Ğ¸Ñ‚ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¹.')
            return
        
    @loader.command()
    async def namecheck(self, message):
        '''- Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ½Ğ¸ĞºĞ½ĞµĞ¹Ğ¼Ğ°'''
        text = f'<emoji document_id=5334882760735598374>ğŸ“</emoji> Ğ’Ğ°Ñˆ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚: <code>{self.get("nick")}</code>' if self.get('nick') != None else '<emoji document_id=5334882760735598374>ğŸ“</emoji> Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ½Ğ¸ĞºĞ° Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½.'
        await utils.answer(message, text)
        
    @loader.command()
    async def namestatus(self, message):
        '''- Ğ²ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ / Ğ²Ñ‹ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ'''
        if self.get('status') == True:
            self.set('status', False)
            await utils.answer(message, f'<emoji document_id=5332533929020761310>âœ…</emoji> ĞœĞ¾Ğ´ÑƒĞ»ÑŒ NameTime Ğ²Ñ‹ĞºĞ»ÑÑ‡ĞµĞ½.')
            return
        else:
            if self.get('nick') != None:
                if self.get('fact_status') == False:
                    self.set('status', True)
                    await utils.answer(message, f'<emoji document_id=5332533929020761310>âœ…</emoji> ĞœĞ¾Ğ´ÑƒĞ»ÑŒ NameTime Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½.')
                    await self.nametime_function()
                    return
                else:
                    self.set('status', True)
                    await utils.answer(message, f'<emoji document_id=5332533929020761310>âœ…</emoji> ĞœĞ¾Ğ´ÑƒĞ»ÑŒ NameTime Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½.')
                    return
            else:
                await utils.answer(message, f'<emoji document_id=5980953710157632545>ğŸš«</emoji> <b>Error</b> // <code>{message.raw_text}</code>'
                '\n\n<emoji document_id=5818973781707722673>ğŸ—£</emoji> <b><u>Ğ¡ÑƒÑ‚ÑŒ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸:</u></b>\nĞ’Ñ‹ Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ğ»Ğ¸ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ½Ğ¸ĞºĞ°.'
                '\n\n<emoji document_id=5821302890932736039>ğŸ—£</emoji> <b><u>Ğ¡Ğ¿Ğ¾ÑĞ¾Ğ±Ñ‹ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ:</u></b>\nĞ£ĞºĞ°Ğ¶Ğ¸ĞµÑ‚ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ½Ğ¸ĞºĞ½ĞµĞ¹Ğ¼Ğ°, Ğ° Ğ·Ğ°Ñ‚ĞµĞ¼ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ.')
                return
        
    async def nametime_function(self):
        while True:
            await asyncio.sleep(0.5)
            if self.get('status') == True:
                if self.get('nick') != None:
                    self.set('fact_status', True)
                    nick = self.get('nick')
                    current_time = datetime.datetime.now()
                    timezone = self.config['timezone'] 
                    new_time = current_time + datetime.timedelta(hours=timezone)
                    time = new_time.strftime("%H:%M")
                    nick = nick.format(time = time)
                    await self.client(functions.account.UpdateProfileRequest(first_name=nick))
                    await asyncio.sleep(self.config['sleep'] * 60)
                else:
                    await self.inline.bot.send_message(self.tg_id, f'â—ï¸ ĞœĞ¾Ğ´ÑƒĞ»ÑŒ NameTime Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ, Ñ‚Ğº Ğ²Ñ‹ Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ğ»Ğ¸ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ½Ğ¸ĞºĞ°.')
                    self.set('status', False)
                    self.set('fact_status', False)
                    break
            else:
                self.set('fact_status', False)
                break
                

